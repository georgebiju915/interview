<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Task API Tester</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f8fa;
    margin: 0;
    padding: 20px;
  }
  h1 {
    text-align: center;
    color: #1976d2;
  }
  .container {
    max-width: 700px;
    margin: 0 auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  input, textarea, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
    font-size: 1em;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  button {
    background: #1976d2;
    color: white;
    cursor: pointer;
  }
  button:hover {
    background: #125ca0;
  }
  .task {
    border-bottom: 1px solid #eee;
    padding: 10px 0;
  }
  .task.done {
    text-decoration: line-through;
    color: #777;
  }
  .status {
    text-align: center;
    margin-top: 10px;
    color: #555;
  }
  .api-switch {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 10px 0;
  }
</style>
</head>
<body>
  <h1>ðŸ§© Task API Tester</h1>
  <div class="container">
    <div class="api-switch">
      <button id="localBtn">Use Local API</button>
      <button id="renderBtn">Use Render API</button>
    </div>
    <p class="status">Active API: <strong id="apiUrl"></strong></p>

    <div>
      <input type="text" id="title" placeholder="Task title" />
      <textarea id="desc" placeholder="Task description"></textarea>
      <button id="addBtn">Add Task</button>
    </div>

    <h3>Tasks</h3>
    <div id="taskList"></div>
  </div>

  <script>
    const apiText = document.getElementById("apiUrl");
    const localBtn = document.getElementById("localBtn");
    const renderBtn = document.getElementById("renderBtn");
    const addBtn = document.getElementById("addBtn");
    const taskList = document.getElementById("taskList");
    const titleInput = document.getElementById("title");
    const descInput = document.getElementById("desc");

    // Default API base (Render)
    let API_BASE = "https://interview-91dh.onrender.com/api";
    apiText.textContent = API_BASE;

    // Switch API endpoints
    localBtn.onclick = () => {
      API_BASE = "http://127.0.0.1:8000/api";
      apiText.textContent = API_BASE;
      loadTasks();
    };

    renderBtn.onclick = () => {
      API_BASE = "https://interview-91dh.onrender.com/api";
      apiText.textContent = API_BASE;
      loadTasks();
    };

    // Fetch all tasks
    async function loadTasks() {
      taskList.innerHTML = "<p>Loading tasks...</p>";
      try {
        const res = await fetch(`${API_BASE}/tasks/`);
        if (!res.ok) throw new Error(`Error ${res.status}`);
        const data = await res.json();
        renderTasks(data);
      } catch (err) {
        taskList.innerHTML = `<p style='color:red'>Failed to load tasks: ${err.message}</p>`;
      }
    }

    // Render task list
    function renderTasks(tasks) {
      if (!tasks.length) {
        taskList.innerHTML = "<p>No tasks yet.</p>";
        return;
      }
      taskList.innerHTML = "";
      tasks.forEach((t) => {
        const div = document.createElement("div");
        div.className = "task" + (t.completed ? " done" : "");
        div.innerHTML = `
          <strong>${t.title}</strong><br/>
          ${t.description || ""}<br/>
          <small>Updated: ${new Date(t.updated_at).toLocaleString()}</small><br/>
          <button onclick="toggleTask('${t.id}', ${t.completed})">${t.completed ? "Mark Incomplete" : "Mark Complete"}</button>
          <button onclick="deleteTask('${t.id}')">Delete</button>
        `;
        taskList.appendChild(div);
      });
    }

    // Add new task
    addBtn.onclick = async () => {
      const title = titleInput.value.trim();
      const desc = descInput.value.trim();
      if (!title) return alert("Title is required!");
      const payload = { title, description: desc };
      try {
        const res = await fetch(`${API_BASE}/tasks/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        if (!res.ok) throw new Error(`Error ${res.status}`);
        titleInput.value = "";
        descInput.value = "";
        loadTasks();
      } catch (err) {
        alert("Failed to add task: " + err.message);
      }
    };

    // Toggle completion status
    async function toggleTask(id, completed) {
      try {
        const res = await fetch(`${API_BASE}/tasks/${id}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ completed: !completed }),
        });
        if (!res.ok) throw new Error(`Error ${res.status}`);
        loadTasks();
      } catch (err) {
        alert("Failed to update task: " + err.message);
      }
    }

    // Delete task
    async function deleteTask(id) {
      if (!confirm("Delete this task?")) return;
      try {
        const res = await fetch(`${API_BASE}/tasks/${id}`, { method: "DELETE" });
        if (!res.ok) throw new Error(`Error ${res.status}`);
        loadTasks();
      } catch (err) {
        alert("Failed to delete task: " + err.message);
      }
    }

    // Load initial tasks
    loadTasks();
  </script>
</body>
</html>
